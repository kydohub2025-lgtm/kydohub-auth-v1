{
  "$jsonSchema": {
    "bsonType": "object",
    "required": [
      "tenantId",
      "tenantCode",
      "schemaVersion",
      "studentId",
      "contactId",
      "role",
      "audit"
    ],
    "additionalProperties": false,
    "properties": {
      "tenantId": { "bsonType": "objectId" },
      "tenantCode": { "bsonType": "string", "minLength": 1 },
      "schemaVersion": { "bsonType": "int", "minimum": 1 },

      "studentId": { "bsonType": "objectId" },
      "contactId": { "bsonType": "objectId" },
      "role": { "enum": ["guardian", "family", "pickup"] },

      "capabilities": {
        "bsonType": ["object", "null"],
        "additionalProperties": false,
        "properties": {
          "canReceiveUpdates": { "bsonType": ["bool", "null"] },
          "canViewPayments": { "bsonType": ["bool", "null"] },
          "canMessage": { "bsonType": ["bool", "null"] },
          "canPickup": { "bsonType": ["bool", "null"] }
        }
      },

      "invite": {
        "bsonType": ["object", "null"],
        "additionalProperties": false,
        "properties": {
          "status": { "enum": ["none", "invited", "accepted", "revoked", null] },
          "invitedAt": { "bsonType": ["date", "null"] },
          "acceptedAt": { "bsonType": ["date", "null"] },
          "revokedAt": { "bsonType": ["date", "null"] }
        }
      },

      "pickupCode": {
        "bsonType": ["object", "null"],
        "additionalProperties": false,
        "properties": {
          "override": { "bsonType": ["string", "null"] }
        }
      },

      "billingForThisStudent": {
        "bsonType": ["object", "null"],
        "additionalProperties": false,
        "properties": {
          "isPayer": { "bsonType": ["bool", "null"] },
          "payerSharePercent": { "bsonType": ["double", "int", "null"], "minimum": 0, "maximum": 100 },
          "notes": { "bsonType": ["string", "null"] }
        }
      },

      "legal": {
        "bsonType": ["object", "null"],
        "additionalProperties": false,
        "properties": {
          "custodyType": { "enum": ["joint", "sole", "restricted", null] },
          "hasCourtRestrictions": { "bsonType": ["bool", "null"] },
          "notes": { "bsonType": ["string", "null"] }
        }
      },

      "audit": {
        "bsonType": "object",
        "required": ["createdAt", "createdBy", "updatedAt", "updatedBy"],
        "additionalProperties": false,
        "properties": {
          "createdAt": { "bsonType": "date" },
          "createdBy": { "bsonType": "string" },
          "updatedAt": { "bsonType": "date" },
          "updatedBy": { "bsonType": "string" },
          "deleted": { "bsonType": ["bool", "null"] },
          "deletedAt": { "bsonType": ["date", "null"] },
          "deletedBy": { "bsonType": ["string", "null"] }
        }
      }
    }
  }
}
